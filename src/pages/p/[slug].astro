---
import fetchApi from "../../lib/strapi";
import type Plan from "../../interfaces/plan";
import Canvas from "../../components/canvas";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const plans = await fetchApi<Plan[]>({
    endpoint: "plans",
    wrappedByKey: "data",
    fields: ["areas", "notes"],
  });

  return plans.map((plan) => ({
    params: { slug: plan.attributes.slug },
    props: plan,
  }));
}
type Props = Plan;

const plan = Astro.props;

// console.log(plan.attributes.svg);
---

<Layout>
  <h1>{plan.attributes.name}</h1>

  <address class="capitalize">
    <span class="kilimanjaro">{plan.attributes.address}</span><br />
    {
      plan.attributes?.areas.data[0]?.attributes?.name ??
        "No area name available"
    }<br />
  </address>

  <Canvas svgProp={plan.attributes} client:load />
</Layout>

<!-- http://45.79.101.19:1340/api/plans?populate[areas]=true -->
<!-- http://45.79.101.19:1340/api/plans?populate[areas]=true&[notes]=true -->
